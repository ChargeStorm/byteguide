{% extends 'base.html' %}
{% block body %}
    <style type="text/css">
    img.resize {
        width: 80%;
        height: auto;
    }
    </style>
    <div class="container">
        <h3>How to upload documentation</h3>
        <hr />
        <h5>First register the project / module / package</h5>
        <div>
            First step is to register the project to get the key for uploading versions. Create a json file with the following content, name and description is mandatory.
        </div>
        <br>
        <pre>
    $ cat register.json
    {
        "name": "my-project",
        "description": "This is a sample project",
        "owner": "Ninad Mhatre",                  <-- metadata: Proj owner name
        "owner-email": "some.thing@other.com",    <-- metadata: Proj owner email
        "programming-lang": "Python",             <-- metadata: Major prog language
        "tags": ["python", "sample", "project"]   <-- metadata: Tags, for searching
    }


    $ curl -X POST -d @register.json \
        -H 'Content-Type: application/json' \
        http://10.249.1.12:8000//manage/register

    # This returns a JSON response
   {
        "message": "project ['my-project'] already registered!",  <-- response text
        "project": "my-project",                                  <-- registered proj name
        "unique-key": "b5eb5695-f10e-4f04-9a10-bd33a1b084c7"       <-- unique-key to use for uploading versions.
    }
    </pre>
        <h5>Upload version to project</h5>
        <div>
            <ol>
                <li>
                    Generate project documentation as html using your favorite tool (<b>the docs must have an index.html entrypoint file</b>)
                </li>
                <li>
                    Zip the documentation in the format <i>projectname-version</i>.zip (<b>the index.html file must be on the root level of the zip file and the name and version needs to be correctly set in the filename</b>)
                </li>
                <br>
                <pre>
$ cd my_project/docs

$ tree
(.venv) ~/projects/my-project/docs$ tree -L 1
    .
    ├── filekeeper.html
    ├── getconfig.html
    └── index.html        <-- This file must be there on root level

$ zip -r my-project-0.1.0.zip *
                </pre>
                <li>Upload the zip file</li>
                <pre>
$ curl -X POST -F "file=@my-project-0.1.0.zip" -F unique-key=b5eb5695-f10e-4f04-9a10-bd33a1b084c7 http://10.249.1.12:8000/manage/upload
                </pre>
                <br />
            </ol>
        </div>
        <h3>Known Issues</h3>
        <div>
            <ol>
                <li>
                    <b>Subpages in MkDocs generated documentation does not work</b>
                    <p>
                        <br>
                        <b>Reason:</b>
                        The current setup of ByteGuide does not support <i>directory urls</i>,
                        which is the default behavior of MkDocs.
                        <br>
                        <br>
                        Directory urls mean that the subpages are accessed by the directory name
                        and not the filename to get cleaner urls. The webserver then needs to assume
                        that there exists a index.html file in that directory and serve that.
                        <br>
                        <br>
                        <b>Workaround:</b>
                        To turn of directory urls, add the following to the mkdocs.yml file:
                        <pre>
    use_directory_urls: false
                        </pre>
                    </p>
                </li>
                <li>
                    <b>The url is always /browse/view/{project}/{version} when navigating subpages,
                    making it difficult to share links</b>
                </b>
                <p>
                    <br>
                    <b>Reason:</b>
                    ByteGuide shows a scroll bar of available versions when
                    inside of a documentation version.
                    <p>
                        <img src="/static/version_scroll_list.png" alt="Version scroll bar">
                    </p>
                    This works by using html concept called <i>iframe</i> to embed the
                    documentation which is actually located at <code>/browse/{project}/{version}</code>
                    in the <code>/browse/view/{project}/{version}</code> page which has this top bar.
                    Because of this the url is always <code>/browse/view/{project}/{version}</code> when
                    navigating subpages with the "version top bar" available.
                    <br>
                    <br>
                    <b>Workaround:</b>
                    To get to the "real" documentation page you can actually click on
                    your documentation name in the upper right corner of the page. This
                    will take you to documentation page of the current version where
                    the url is dynamically updated while navigating subpages.
                    <p>
                        <img src="/static/project_link.png" alt="Project link">
                    </p>
                </p>
            </li>
            <li>
                <b>It's not possible to delete versions or whole projects through curl</b>
            </b>
            <p>
                <br>
                <b>Reason:</b>
                This is not yet implemented.
                <br>
                <br>
                <b>Workaround:</b>
                To overwrite an existing version use that `reupload` flag described in the FAQ below.
                If you really need to have a version or project deleted, please contact the site admin which have
                access to the hosting server.
            </p>
        </li>
    </ol>
</div>
<h3>FAQ</h3>
<div>
    <ol>
        <li>
            <b>Can I upload a version which does not conform to SemVer?</b>
            <p>
                <br>
                <b>Answer:</b>
                It's absolutely fine to upload versions which do not conform to SemVer. One example of this would be
                if you want to upload a version from your main/master/dev branch such as in the example below:
                <pre>
curl -X POST -F file=@tests/static/test_docs/Sample-Proj-main.zip -F unique-key=743b92dc-ee45-4671-966a-0e8fa5def464 http://127.0.0.1:8000/manage/upload
                    </pre>
                The only requirement is that the version number is unique and alphanumeric.
            </p>
        </li>
        <li>
            <b>Can I upload the same version multiple times?</b>
            <p>
                <br>
                <b>Answer:</b>
                For this you can use the `reupload` flag as in the following example:
                <pre>
curl -X POST -F file=@tests/static/test_docs/Sample-Proj-main.zip -F unique-key=743b92dc-ee45-4671-966a-0e8fa5def464 -F reupload=true http://127.0.0.1:8000/manage/upload
                    </pre>
                Again an example of this would be if you want to upload a version from your main/master/dev branch again and again.
            </p>
        </li>
    </ol>
</div>
{% if copyright %}
    <hr>
    <footer>
        <div class="row">
            <div class="col-lg-12">
                <p>{{ copyright|safe }}</p>
            </div>
        </div>
    </footer>
{% endif %}
</div>
{% endblock %}
